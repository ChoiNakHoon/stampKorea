{% extends "base.html" %}
{% block page_title %} Search {% endblock %}

{% block search-bar %}{% endblock search-bar %}
{% block content %}
    <form method="GET" action="{% url 'places:search'%}">
        {{form.region}}
        {{form.city}}
        {{form.cat_type}}
        <button>Search</button>
    </form>

    <h2>Result</h2>
    {% for place in places %}
        {% include 'mixins/place_card.html' with place=place %}
    {% endfor %}

    {% if places.has_previous %}
        <a href="?page=1">First</a>
        <a href="?page={{places.previous_page_number}}">Previous</a>
    {% endif %}

    <!-- 페이지의 갯수 만큼 Loop -->
    {% for index in page_range %}
    <!-- current page -->
    {% if places.paginator.number == index %}
            <span>{{index}}</span>
        {% else %}
        <!-- current page가 아니라면 -->
            <a href="?page={{index}}">{{index}}</a>
        {% endif %}

    {% endfor %}

    {% if places.has_next %}
        <a href="?page={{places.next_page_number}}">Next</a>zz
        <a href="?page={{places.paginator.num_pages}}">Last</a>
    {% endif %}

    <script>
        const region = document.querySelector("#id_region");
        const city = document.querySelector("#id_city");
        function handleSelectedChanger(event) {
            document.querySelector("form").submit();
        }
        region.addEventListener("change", handleSelectedChanger);

    </script>
{% endblock content %}